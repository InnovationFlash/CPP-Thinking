# 堆/栈的历史问题：
之前并没有太多深究这个问题，最近在看多线程网络库的时候涉及到了很多该问题，做个总结；

堆和栈本质上都是空间分配的不同形式，出现也有历史问题；

看网上的一些论述，最早是堆分配先出现，后来随着计算机的中断等需要，才出现了栈分配；

从本质上来看，栈分配就是为了调用顺序而出现的；
例如中断IO调用，当产生中断，必须要先保护现场，也就是CPU状态存入内存，之后记录中断地址，转而进行中断处理；
当中断处理结束，还要返回函数地址，恢复现场，继续执行；
从流程处理来看，如果存在多个中断嵌套，则处理符合栈的流程，先入后出；

而堆则是对应于页面分配系统；
如果按照栈的方式管理对象的分配和销毁，则必定出现先创建的对象应该最后销毁的情况；
在计算机内存管理中，有合并碎片内存的概念；
如果不采用堆，则不能进行中间内存块的析构和合并，也就不能灵活的使用内存页，这和内存的页面的使用初衷是违背的；

因此，堆和栈要结合实际的应用场景来看，尤其是计算机的内存背景；



# 实际使用场景：
对于CPP来说，最主要的是两者的使用场景不一样；

栈的最大优势在于：不用手动的去释放内存；
堆的最大优势在于：创建的对象在整个周期中一直存在，没有释放顺序；

CPP中如果进行栈创建，也就是不通过new创建，在结束作用域的时候必定会默认将该对象销毁，这是自发进行的，因此最大的缺点也是，不能在整个程序生命周期中使其一直存在，而且对象过多的情况下很有可能有爆栈风险；

同时，栈分配也需要提前知道实际要分配多少空间，这也为动态增长带来了困难；

而CPP中使用堆，则会有很多问题，典型的就是内存泄漏，这也是为什么new和delete要成对出现的原因；

堆中new出的对象，可以在整个周期中存在，做到你不释放，我就一直存在的特点；

所以两者有各自侧重点：
局部对象不用在作用域结束后存在——栈；
多线程或者整个生命周期都要访问——堆；

参考文献：https://www.zhihu.com/question/281940376